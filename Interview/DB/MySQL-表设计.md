## 为什么一定要设一个主键？

在有些情况下，就能显式的用上主键索引，提高查询效率！

## 你们主键是用自增还是UUID?

innodb 中的主键是聚簇索引。如果主键是自增的，那么每次插入新的记录，记录就会顺序添加到当前索引节点的后续位置，当一页写满，就会自动开辟一个新的页。如果不是自增主键，那么可能会在中间插入，就会引发页的分裂，产生很多表碎片！。

当主键是UUID的时候，插入时间更长，而且索引占用空间更大！

## 主键为什么不推荐有业务含义?

- 因为任何有业务含义的列都有改变的可能性,主键一旦带上了业务含义，那么主键就有可能发生变更。

- 带有业务含义的主键，不一定是顺序自增的。那么就会导致数据的插入顺序，并不能保证后面插入数据的主键一定比前面的数据大。

  可能引发页分裂，产生空间碎片

### 自增主键用完了怎么办

我们以无符号整型为例，存储范围为0～4294967295，约43亿！我们先说一下，一旦自增id达到最大值，此时数据继续插入是会报一个主键冲突异常如下所示
//Duplicate entry '4294967295' for key 'PRIMARY'

- "简单啊，把自增主键的类型改为BigInt类型就好了！"

- 面试官:"你在线上怎么修改列的数据类型的？"   

mysql> ALTER TABLE table_name CHANGE old_field_name new_field_name field_type;

在mysql5.5这个版本之前
执行ALTER语句后，会新建一个带有新结构的临时表，将原表数据全部拷贝到临时表，然后Rename，完成创建操作。这个方式过程中，原表是可读的，不可写。

在5.6+开始，mysql支持在线修改数据库表，在修改表的过程中，对绝大部分操作，原表可读，也可以写。

对于修改数据类型这种操作，是不支持并发的DML操作！也就是说，如果你直接使用ALTER这样的语句在线修改表数据结构，会导致这张表无法进行更新类操作(DELETE、UPDATE、DELETE)。
因此，直接ALTER是不行滴！

面试官:"那自增主键达到最大值了，用完了怎么办？"   

你:"这问题没遇到过，因为自增主键我们用int类型，一般达不到最大值，我们就分库分表了，所以不曾遇见过！"

## 表示枚举的字段为什么不用enum类型？

在工作中表示枚举的字段，一般用tinyint类型。

- ENUM类型的ORDER BY操作效率低，需要额外操作

- 如果枚举值是数值，有陷阱 举个例子，表结构如下
CREATE TABLE test (foobar ENUM('0', '1', '2'));

错误❌
mysql> INSERT INTO test VALUES (1);

正确✅
mysql> INSERT INTO test VALUES (`1`);

## 货币字段用什么类型?

如果货币单位是分，可以用Int类型。如果坚持用元，用Decimal。

千万不要答float和double，因为float和double是以二进制存储的，所以有一定的误差。 打个比方，你建一个列如下
CREATE TABLE `t` (
  `price` float(10,2) DEFAULT NULL,
) ENGINE=InnoDB DEFAULT CHARSET=utf8

然后insert给price列一个数据为1234567.23，你会发现显示出来的数据变为1234567.25，精度失准！

## 时间字段用什么类型?

- timestamp，该类型是四个字节的整数，它能表示的时间范围为1970-01-01 08:00:01到2038-01-19 11:14:07。2038年以后的时间，是无法用timestamp类型存储的。 但是它有一个优势，timestamp类型是带有时区信息的。一旦你系统中的时区发生改变，例如你修改了时区
SET TIME_ZONE = "america/new_york";
你会发现，项目中的该字段的值自己会发生变更。这个特性用来做一些国际化大项目，跨时区的应用时，特别注意！

- datetime，datetime储存占用8个字节，它存储的时间范围为1000-01-01 00:00:00 ~ 9999-12-31 23:59:59。显然，存储时间范围更大。但是它坑的地方在于，他存储的是时间绝对值，不带有时区信息。如果你改变数据库的时区，该项的值不会自己发生变更！

## 为什么不直接存储图片、音频、视频等大容量内容?

保持数据库瘦身很重要，存资源是大忌，资源文件存OSS统一做CDN(CDN - Content Delivery Network)
[一分钟自我介绍：阿里云CDN](https://yq.aliyun.com/articles/95205?spm=5176.2000012.0.0.6faed3cdGwDZYp)
简单来说，CDN就是将源站内容分发至全国所有的节点，缩短用户查看对象的延迟，提高用户访问网站的响应速度与网站的可用性，解决网络带宽小、用户访问量大、网点分布不均等问题。

CDN适合静态资源较多的站点/应用加速。视音频点播/大文件下载分发加速也可应用CDN。此外，CDN也适用视频直播加速和移动应用加速。
一般什么产品和我可以搭配使用呢？
ECS、OSS、媒体转码、消息服务、移动加速都是常见的可搭配使用的产品。

我们在实际应用中，都是用HDFS来存储文件。然后mysql中，只存文件的存放路径。

mysql中有两个字段类型被用来设计存放大容量文件，也就是text和blob类型。但是，我们在生产中，基本不用这两个类型！

- Mysql内存临时表不支持TEXT、BLOB这样的大数据类型，如果查询中包含这样的数据，在排序等操作时，就不能使用内存临时表，必须使用磁盘临时表进行。导致查询效率缓慢

- binlog内容太多。因为你数据内容比较大，就会造成binlog内容比较多。大家也知道，主从同步是靠binlog进行同步，binlog太大了，就会导致主从同步效率问题！

## 字段为什么要定义为NOT NULL?

- Mysql难以优化引用可空列查询，它会使索引、索引统计和值更加复杂。可空列需要更多的存储空间，还需要mysql内部进行特殊处理。可空列被索引后，每条记录都需要一个额外的字节，还能导致MYisam 中固定大小的索引变成可变大小的索引。

- 因为null列的存在，会出现很多出人意料的结果，从而浪费开发时间去排查Bug.


