## CJS
CJS is short for CommonJS. Here is what it looks like:
```js
//importing 
const doSomething = require('./doSomething.js'); 

//exporting
module.exports = function doSomething(n) {
  // do something
}
```
- CJS imports module synchronously. ä»¥åŒæ­¥çš„å½¢å¼å¼•å…¥æ¨¡å—
  You can import from a library node_modules or local dir. 
  Either by const myLocalModule = require('./some/local/file.js') or var React = require('react'); works.
- When CJS imports, it will give you a copy of the imported object. å¼•å…¥çš„æ˜¯å¯¹è±¡çš„æ‹·è´
- CJS will not work in the browser. It will have to be transpiled and bundled.(Reactå’ŒVueå¯èƒ½æœ‰è¿™ä¸ªè¿‡ç¨‹)

### module.exports å’Œ exports
moduleæ˜¯ä¸€ä¸ªå¸¦æœ‰exportså±æ€§çš„å¯¹è±¡ï¼Œexportsæ˜¯æ™®é€šçš„jså˜é‡ï¼Œæ˜¯module.exportsçš„å¼•ç”¨ã€‚

æ€»ç»“ï¼šä½ å¯ä»¥ä½¿ç”¨module.exports æˆ– exportsçš„ä»»ä½•ä¸€ä¸ªæ¥ç¼–å†™ä½ çš„JSæ¨¡å—ï¼Œå› ä¸ºå®ƒä»¬æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚
å½“ä½ ä¸ºæ¨¡å—æ·»åŠ exports.foo = "bar" å’Œ module.exports.baz = "boz" å±æ€§ï¼Œä½ å¯¼å‡ºçš„æ¨¡å—å°†æ˜¯è¿™ä¸ªæ ·å­ï¼š
```js
{foo: "bar", baz: "boz"}
```
ä½†æ˜¯ï¼Œå¦‚æœä½ è¦å¯¼å‡ºä¸€ä¸ªfunction, or a string, or a unicorn(ç‹¬è§’å…½ğŸ¦„)æ€ä¹ˆåŠ?

è¿™å°±è§¦ç¢°åˆ°äº†module.exports æˆ– exportsçœŸæ­£çš„åŒºåˆ«ï¼ˆå¦‚æœä½ ä¸æƒ³çŸ¥é“ç¥é©¬ç»†èŠ‚ï¼Œè®°ä½ä½¿ç”¨model.exportså°±å¯¹äº†ï¼‰ï¼Œ
å› ä¸ºä½ æƒ³å¯¼å‡ºä¸€ä¸ªfunctionè€Œä½¿ç”¨äº†exportsï¼Œé‚£ä¹ˆæ­å–œï¼Œä½ å®é™…å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ã€‚


## CommonJS å½¢å¼
The module.exports or exports is a special object which is included in every JS file in the Node.js application by default. 

module.exports æˆ–è€… exports æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œæ˜¯node.jsåº”ç”¨ä¸­æ¯ä¸ªjsæ–‡ä»¶é»˜è®¤å°±æœ‰çš„

> The following example exposes simple string message as a module in Message.js.
1. æ¨¡å—ç›´æ¥å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²
```js
// message.js
module.exports = "Hello world";

// or
exports = 'Hello world';

// Now, import this message module and use it as shown below.
// app.js
var msg = require('./Messages.js');

console.log(msg);
```

> exports is an object. So, you can attach properties or methods to it. The following example exposes an object with a string property in Message.js file.
2. æ¨¡å—å¯¼å‡ºä¸€ä¸ªå±æ€§å˜é‡ ä¸ºå­—ç¬¦ä¸²
```js
// message.js
exports.SimpleMessage = 'Hello world';

//or
module.exports.SimpleMessage = 'Hello world';


//app.js
var msg = require('./Messages.js');

console.log(msg.SimpleMessage);
```
In the above example, require() function will return an object { SimpleMessage : 'Hello World' }

> The same way as above, you can expose an object with function. The following example exposes an object with log function as a module.
3. å¯¼å‡ºä¸€ä¸ªfunction
```js
// log.js
module.exports.log = function (msg) { 
    console.log(msg);
};

// app.js
var msg = require('./Log.js');
msg.log('Hello World');
```
The above module will expose an object- { log : function(msg){ console.log(msg); } } . Use the above module as shown below.

> You can also attach an object to module.exports as shown below.
4. å¯¼å‡ºä¸€ä¸ªå¯¹è±¡
```js
// data.js
module.exports = {
    firstName: 'James',
    lastName: 'Bond'
}

// app.js
var person = require('./data.js');
console.log(person.firstName + ' ' + person.lastName);

module.exports = function send(mail) {
  transporter.sendMail(mail, (error, info) => {
    if (error) {
      return console.log(error);
    }
    console.log('mail sent:', info.response);
  });
};
```

## AMD(Asynchronous Module Definition)
è¿™å¯¹æœåŠ¡å™¨ç«¯ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ‰€æœ‰çš„æ¨¡å—éƒ½å­˜æ”¾åœ¨æœ¬åœ°ç¡¬ç›˜ï¼Œå¯ä»¥åŒæ­¥åŠ è½½å®Œæˆï¼Œç­‰å¾…æ—¶é—´å°±æ˜¯ç¡¬ç›˜çš„è¯»å–æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå¯¹äºæµè§ˆå™¨ï¼Œè¿™å´æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå› ä¸ºæ¨¡å—éƒ½æ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼Œç­‰å¾…æ—¶é—´å–å†³äºç½‘é€Ÿçš„å¿«æ…¢ï¼Œå¯èƒ½è¦ç­‰å¾ˆé•¿æ—¶é—´ï¼Œæµè§ˆå™¨å¤„äº"å‡æ­»"çŠ¶æ€ã€‚

AMDè¯ç”Ÿçš„åŸå› æ˜¯ï¼Œæ˜¯å› ä¸ºCommonJSä¸æ”¯æŒå¼‚æ­¥åŠ è½½ï¼Œä¸é€‚åˆæµè§ˆå™¨ç¯å¢ƒã€‚RequireJSå®ç°äº†AMD APIã€‚ç¤ºä¾‹å¦‚ä¸‹ã€‚
ç›®å‰ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªJavascriptåº“å®ç°äº†AMDè§„èŒƒï¼šrequire.jså’Œcurl.jsã€‚

### [RequireJS](https://requirejs.org/)
RequireJS is a JavaScript file and module loader. It is optimized for in-browser use, but it can be used in other JavaScript environments, like Rhino and Node. Using a modular script loader like RequireJS will improve the speed and quality of your code.
RequireJS æ˜¯ JavaScript æ–‡ä»¶çš„æ¨¡å—åŠ è½½å™¨ã€‚

Load JavaScript Files
```js
<!--This sets the baseUrl to the "scripts" directory, and
    loads a script that will have a module ID of 'main'-->
<script data-main="scripts/main.js" src="scripts/require.js"></script>
```

AMD stands for Asynchronous Module Definition. Here is a sample code:
```js
define(['dep1', 'dep2'], function (dep1, dep2) {
    //Define the module value by returning a value.
    return function () {};
});
or
// "simplified CommonJS wrapping" https://requirejs.org/docs/whyamd.html
define(function (require) {
    var dep1 = require('dep1'),
        dep2 = require('dep2');
    return function () {};
});
```
- AMD imports modules asynchronously (hence the name).
- AMD is made for frontend (when it was proposed) (while CJS backend). AMD ç»™å‰ç«¯æµè§ˆå™¨ç”¨ï¼ŒCJSç»™åç«¯æœåŠ¡å™¨ç”¨

## UMD
UMDæ¨¡å—æ˜¯ä¸€ç§é€šç”¨çš„æ¨¡å¼ï¼Œç”¨äºå…¼å®¹AMDå’ŒCommonJSçš„è§„èŒƒã€‚UMDè§„èŒƒåŒæ—¶å…¼å®¹amdå’Œcommonjsï¼Œå¹¶æ”¯æŒä¼ ç»Ÿçš„å…¨å±€å˜é‡çš„æ¨¡å¼ã€‚

UMDæ¨¡å—çš„é¡¶ç«¯é€šå¸¸éƒ½ä¼šæœ‰å¦‚ä¸‹çš„ä»£ç ï¼Œç”¨æ¥åˆ¤æ–­æ¨¡å—åŠ è½½å™¨ç¯å¢ƒã€‚
```js
(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD
    define(['jquery'], factory);
  } else if (typeof exports === 'object') {
    // CommonJS
    module.exports = factory(require('jquery'));
  } else {
    // å…¨å±€å˜é‡
    root.returnExports = factory(root.jQuery);
  }
}(this, function ($) {
  // ...
}));
```

## CMD (SeaJS)
CMDè§„èŒƒå’ŒAMDç±»ä¼¼ï¼Œéƒ½ä¸»è¦è¿è¡Œäºæµè§ˆå™¨ç«¯ï¼Œå†™æ³•ä¸Šçœ‹èµ·æ¥ä¹Ÿå¾ˆç±»ä¼¼ã€‚ä¸»è¦æ˜¯åŒºåˆ«åœ¨äº æ¨¡å—åˆå§‹åŒ–æ—¶æœº

- AMDä¸­åªè¦æ¨¡å—ä½œä¸ºä¾èµ–æ—¶ï¼Œå°±ä¼šåŠ è½½å¹¶åˆå§‹åŒ–
- CMDä¸­ï¼Œæ¨¡å—ä½œä¸ºä¾èµ–ä¸”è¢«å¼•ç”¨æ—¶æ‰ä¼šåˆå§‹åŒ–ï¼Œå¦åˆ™åªä¼šåŠ è½½ã€‚
- CMD æ¨å´‡ä¾èµ–å°±è¿‘ï¼ŒAMD æ¨å´‡ä¾èµ–å‰ç½®ã€‚

## ES6 Import export
```js
// lib.js
export const sqrt = Math.sqrt;

export function square(x) {
    return x * x;
}

export function diag(x, y) {
    return sqrt(square(x) + square(y));
}


// main.js
import { square, diag } from 'lib';
console.log(square(11)); // 121
console.log(diag(4, 3)); // 5

// or
import * as lib from 'lib';
console.log(lib.square(11)); // 121
console.log(lib.diag(4, 3)); // 5
```

Default exports (one per module)
```js
// myFunc.js
export default function () { ... };

// main.js
import myFunc from 'myFunc';
myFunc();
```

### ES6 æ¨¡å—ä¸ CommonJS æ¨¡å—çš„å·®å¼‚
https://es6.ruanyifeng.com/#docs/module-loader

CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ŒES6 æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨ã€‚

CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è¾“å‡ºä¸€ä¸ªå€¼ï¼Œæ¨¡å—å†…éƒ¨çš„å˜åŒ–å°±å½±å“ä¸åˆ°è¿™ä¸ªå€¼ã€‚è¯·çœ‹ä¸‹é¢è¿™ä¸ªæ¨¡å—æ–‡ä»¶lib.jsçš„ä¾‹å­ã€‚
```js
// lib.js
var counter = 3;
function incCounter() {
  counter++;
}
module.exports = {
  counter: counter,
  incCounter: incCounter,
};

// main.js
var mod = require('./lib');

console.log(mod.counter);  // 3
mod.incCounter();
console.log(mod.counter); // 3

// ä¸Šé¢ä»£ç è¯´æ˜ï¼Œlib.jsæ¨¡å—åŠ è½½ä»¥åï¼Œå®ƒçš„å†…éƒ¨å˜åŒ–å°±å½±å“ä¸åˆ°è¾“å‡ºçš„mod.counteräº†ã€‚è¿™æ˜¯å› ä¸ºmod.counteræ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹çš„å€¼ï¼Œä¼šè¢«ç¼“å­˜ã€‚é™¤éå†™æˆä¸€ä¸ªå‡½æ•°ï¼Œæ‰èƒ½å¾—åˆ°å†…éƒ¨å˜åŠ¨åçš„å€¼ã€‚

// lib.js
var counter = 3;
function incCounter() {
  counter++;
}
module.exports = {
  get counter() {
    return counter
  },
  incCounter: incCounter,
};

$ node main.js
3
4
```
ES6 æ¨¡å—çš„è¿è¡Œæœºåˆ¶ä¸ CommonJS ä¸ä¸€æ ·ã€‚JS å¼•æ“å¯¹è„šæœ¬é™æ€åˆ†æçš„æ—¶å€™ï¼Œé‡åˆ°æ¨¡å—åŠ è½½å‘½ä»¤importï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªåªè¯»å¼•ç”¨ã€‚ç­‰åˆ°è„šæœ¬çœŸæ­£æ‰§è¡Œæ—¶ï¼Œå†æ ¹æ®è¿™ä¸ªåªè¯»å¼•ç”¨ï¼Œåˆ°è¢«åŠ è½½çš„é‚£ä¸ªæ¨¡å—é‡Œé¢å»å–å€¼ã€‚
```js
// lib.js
export let counter = 3;
export function incCounter() {
  counter++;
}

// main.js
import { counter, incCounter } from './lib';
console.log(counter); // 3
incCounter();
console.log(counter); // 4
```
ä¸Šé¢ä»£ç è¯´æ˜ï¼ŒES6 æ¨¡å—è¾“å…¥çš„å˜é‡counteræ˜¯æ´»çš„ï¼Œå®Œå…¨ååº”å…¶æ‰€åœ¨æ¨¡å—lib.jså†…éƒ¨çš„å˜åŒ–ã€‚


## [CommonJS modules - Caching](https://nodejs.org/dist/latest-v14.x/docs/api/modules.html#modules_caching)
æ¨¡å—åœ¨ç¬¬ä¸€æ¬¡åŠ è½½åè¢«ç¼“å­˜ã€‚è¿™æ„å‘³ç€æ¯æ¬¡è°ƒç”¨require('foo')éƒ½ä¼šè¿”å›å®Œå…¨ç›¸åŒçš„å¯¹è±¡ï¼Œå¦‚æœå®ƒè§£æåˆ°ç›¸åŒçš„æ–‡ä»¶ã€‚

å¦‚æœæ ¸å¿ƒæ¨¡å—çš„æ ‡è¯†ç¬¦è¢«ä¼ é€’ç»™require()ï¼Œé‚£ä¹ˆå®ƒä»¬æ€»æ˜¯ä¼˜å…ˆåŠ è½½çš„ã€‚ä¾‹å¦‚ï¼Œrequire('http')å°†å§‹ç»ˆè¿”å›å†…ç½®çš„httpæ¨¡å—ï¼Œå³ä½¿å­˜åœ¨åŒåçš„æ–‡ä»¶ã€‚

## [Cycles å¾ªç¯åŠ è½½](https://nodejs.org/dist/latest-v14.x/docs/api/modules.html#modules_cycles)
å½“æœ‰å¾ªç¯require()è°ƒç”¨æ—¶ï¼Œæ¨¡å—åœ¨è¿”å›æ—¶å¯èƒ½è¿˜æ²¡æœ‰å®Œæˆæ‰§è¡Œã€‚
```js
// a.js
console.log('a starting');
exports.done = false;
const b = require('./b.js');
console.log('in a, b.done = %j', b.done);
exports.done = true;
console.log('a done');

// b.js
console.log('b starting');
exports.done = false;
const a = require('./a.js');
console.log('in b, a.done = %j', a.done);
exports.done = true;
console.log('b done');

// main.js
console.log('main starting');
const a = require('./a.js');
const b = require('./b.js');
console.log('in main, a.done = %j, b.done = %j', a.done, b.done);
```
å½“main.jsåŠ è½½a.jsæ—¶ï¼Œa.jsä¾æ¬¡åŠ è½½b.jsã€‚è¿™æ—¶ï¼Œb.jså°è¯•åŠ è½½a.jsã€‚ä¸ºäº†é˜²æ­¢å‡ºç°æ— é™å¾ªç¯ï¼Œå°†a.js exportså¯¹è±¡çš„æœªå®Œæˆå‰¯æœ¬è¿”å›åˆ°b.jsæ¨¡å—ã€‚ç„¶åb.jså®ŒæˆåŠ è½½ï¼Œå®ƒçš„exportså¯¹è±¡è¢«æä¾›ç»™a.jsæ¨¡å—ã€‚
```js
$ node main.js
main starting
a starting
b starting
in b, a.done = false
b done
in a, b.done = true
a done
in main, a.done = true, b.done = true
```
ä¸ºäº†å…è®¸å¾ªç¯æ¨¡å—ä¾èµ–å…³ç³»åœ¨åº”ç”¨ç¨‹åºä¸­æ­£ç¡®å·¥ä½œï¼Œéœ€è¦ä»”ç»†è§„åˆ’ã€‚