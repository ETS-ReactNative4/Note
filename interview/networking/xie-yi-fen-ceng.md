# 协议分层

## 应用层

HTTP、FTP、Telnet、SMTP、RIP、DNS

## 传输层

TCP、UDP、Socket

### TCP连接与HTTP连接

在网络分层中，HTTP协议是基于TCP协议的，客户端向服务端发送一个HTTP请求时，需要先与服务端建立TCP连接，也就是经典的三次握手（通常对用户来说是很难察觉的），握手成功以后才能进行数据交互。HTTP是基于请求响应模式且无状态的协议，1.1之前只支持短连接，也就是请求响应一次以后连接中断，下次请求需要重新进行TCP连接，而1.1之后支持持长连接，即进行一次TCP连接以后，客户端可以发送多次的HTTP请求给服务器端。

小结：HTTP基于TCP

### TCP连接与Socket连接

Socket是应用层与传输层之间的同一个抽象层，它是一套接口，所以Socket连接可以基于TCP连接，也有可能基于UDP。

小结：Socket可基于TCP，亦可UDP

### HTTP连接与Socket连接

HTTP 1.1之前是短连接，基于TCP协议的Socket连接是长连接，虽然HTTP1.1开始支持长连接，但不像Socket连接一旦建立，除非一方主动断开，否则连接状态一直保持。

基于TCP的Socket可能是短连接，也可能是长连接，长连接可能需要通过心跳等一些手段来维持，各自有不同的应用场景。而不是简单的"基于TCP协议的Socket连接是长连接"。

HTTP连接中，只有客户端发起请求后服务端才会响应，服务端是无法主动向客户端发消息的。而Socket连接中，通信双方发送消息并没有先后的限制，通信双方中的任何一方可以随时向另一方发送消息。

### HTTP Or Socket 使用场景

用HTTP：双方不需要时刻保持连接，客户端只是通过一个个HTTP请求来获取服务器的特定资源。如通过get/post请求获取网页、图片、JSON或者XML数据，还有常用的文件上传、小文件下载等。

用Socket：大部分即时通讯应用（知乎上说QQ有部分功能是基于TCP，因为TCP每次都需要三次握手，虽然可靠但是网络不好的时候就惨了）、聊天室（基于UDP+消息广播的方式）、大文件传输等。

