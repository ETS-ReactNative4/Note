## 老板这么说
双十一之所以成功是因为我的英明决策和运筹帷幄，以及之前大量的宣传和广告的投入，带来了大量的用户，所以我们双十一的销售额猛增。

## 产品和运营团队
双十一之所以成功是因为我们的活动策划做的好，以及产品设计以及品类选择做得成功，用户喜欢我们产品，而且再加上价格的优惠，我们会获得很好的销量

## 技术人员
老板和产品运营说的都是没有错的(但是没有我们服务器迟早要完)，不过虽然说广告投入，商品品类丰富固然吸引大量用户，带来好的销量，但是我们的服务器也会承受更大的压力
无论是前端的Web服务器还是后端的数据库服务器都会承受巨大的压力，对于Web服务器我们可以比较容易的进行横向扩展，但是对于数据库服务器，扩展就没有这么容易，
因为数据库服务器中的数据需要具备完整性和一致性，如果存入了相同的数据那这种一致性就会被打破，所以如果没有数据库服务器的稳定性，那么老板和运营及产品同事所说的恐怕都是一场空。不仅大促的成本很难收回，对网站的影响也是很难估量的。

## 数据库架构
### Master（1个）=> Slave(15个)
一旦Master出现了故障，需要DBA手动从Slave中选择一个提升为Master，并且需要从其他Slave同步数据到Master，同步比较耗时

主服务器配置：CUP：64核 内存：512GB

QPS: 350000
TPS: 80000

算是比较高的吞吐量了

并发量：同一时间处理的请求数量
CPU使用率：接近100%

### 网卡流量
如何避免无法连接数据库的情况：
1. 减少从服务器的数量
2. 进行分级缓存
3. 避免使用select *进行查询
4. 分离业务网络和数据库服务器网络

### 大表对数据库性能的影响
指标：表中的数据量大，超过千万行，表数据文件巨大，表数据文件超过10G

如果是记录操作日志的只有简单的insert操作，没有select delete，更大的数据量可能也没有什么性能问题，但是要给表结构增加列那就麻烦了

大表带来的问题：
1. 大表对DDL操作的影响：建立索引需要很长的时间，风险Mysql版本<5.5 会导致锁表，大于5.5虽然不会锁表但是会引起主从复制的延迟 
2. 如果这种大表修改表结构导致锁表，而又有新的连接进来，这些连接会被阻塞，可以看到服务器的连接数猛增，只有等表结构修改完成才能处理

怎样解决大表的问题：（1.分库分表，2.大表历史数据归档）
#### 分库分表 - 难点：
1. 分表主键的选择
2. 分表后跨分区数据的查询和统计

#### 大表历史数据归档 - 难点
1. 归档时间点的选择

### 大事务对数据库性能的影响(大事务：运行时间比较长，操作的数据比较多的事务)
事务原子性Atomicity：
1. 检查理财账户中的余额是否高于2000元
2. 从理财账户的余额中减去2000元
3. 在活动存款账户增加2000元

事务隔离性Isolation 4中隔离级别：
1. 未提交读(READ UNCOMMITED)脏读：当前事务未提交，其他事务是可以看到未减去的2000元
[隔离级别](../../Interview/DB/MySQL-transaction.md)

大事务带来的风险：
1. 锁定太多的数据，造成大量的阻塞和锁超时
2. 回滚时需要时间比较长
3. 执行时间长，容易造成主从延迟

如何处理大事务：
1. 避免一次处理太多的数据
2. 从事务中移除不必要的select操作


## 数据库服务器性能影响因素
1. 服务器硬件
2. 服务器系统
3. 数据库存储引擎
